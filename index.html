<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <script src="./d3.v4.js"></script>

    <title></title>

    <style type="text/css">
        html,
        body {
            margin: 0;
            padding: 0;
        }

        #svg-holder {
            margin: 30px;
            /*width: 80%;
            max-width: 80%;
            */
            height: 600px;
            border: 1px solid blue;
            /*resize: horizontal;*/
            overflow: hidden;
            /*text-align: center;*/
            padding: 15px;
        }

        svg {
            border: 1px solid red;
            width: 100%;
            height: 100%;
        }

        .fromdate {
            float: left;
        }

        .todate::before {
            content: "\00A0-\00A0";
        }
    </style>
    <script>
        "use strict";
        var data = {
            periods: [

            ],
            projects: [

            ],
        }
    </script>
</head>

<body>
    <div id="svg-holder">
    </div>
    <div id="bio">
        <h1>Work experience</h1>
        <ul id="work">
            <li id="job1">
                <dt>Period</dt>
                <dd class="fromdate">June 2005</dd>
                <dd class="todate">February 2007</dd>
                <dt>Position</dt>
                <dd>Web Developer</dd>
                <dt>Responsibilities</dt>
                <dd>Maintenance and expansion of the existing company web sites</dd>
                <dt>Employer</dt>
                <dd class="title">Some company ltd.</dd>
            </li>
            <li id="job2" class="hidden">
                <dt>Period</dt>
                <dd class="fromdate">November 2007</dd>
                <dd class="todate">February 2008</dd>
                <dt>Position</dt>
                <dd>Web Developer</dd>
                <dt>Responsibilities</dt>
                <dd>Development of new projects, bugfixing and securing completed projects</dd>
                <dt>Employer</dt>
                <dd class="title">Some company 2 ltd.</dd>
            </li>
            <li id="job3">
                <dt>Period</dt>
                <dd class="fromdate">February 2008</dd>
                <dd class="todate">January 2009</dd>
                <dt>Position</dt>
                <dd>Backend Web Developer</dd>
                <dt>Responsibilities</dt>
                <dd>blah blah</dd>
                <dt>Employer</dt>
                <dd class="title">Some company 3 ltd.</dd>
            </li>
            <li id="job4">
                <dt>Period</dt>
                <dd class="fromdate">Jannuary 2009</dd>
                <dd class="todate">November 2010</dd>
                <dt>Position</dt>
                <dd>Freelance Web Developer</dd>
                <dt>Employer</dt>
                <dd class="title">Self-employed</dd>
            </li>
        </ul>
        <h1>Education</h1>
        <ul id="education">
            <li id="highschool">
                <dt>Period</dt>
                <dd class="fromdate">September 2002</dd>
                <dd class="todate">May 2007</dd>
                <dt>Type</dt>
                <dd>High school</dd>
                <dt>Institution</dt>
                <dd class="title">Some high school</dd>
            </li>
            <li id="highschool_extracurricular">
                <dt>Period</dt>
                <dd class="fromdate">October 2002</dd>
                <dd class="todate">September 2003</dd>
                <dt>Type</dt>
                <dd>Extracurricular activities</dd>
                <dt>Institution</dt>
                <dd class="title">Student academy for computer informatics</dd>
            </li>
            <li id="bachelors">
                <dt>Period</dt>
                <dd class="fromdate">October 2007</dd>
                <dd class="todate">May 2012</dd>
                <dt>Type</dt>
                <dd>University bachelor's degree</dd>
                <dt>Institution</dt>
                <dd class="title">Some uni school</dd>
            </li>
        </ul>
        <h1>Projects and Skills</h1>
        <ul id="projects">
            <li id="some_project" data-where="highschool">
                <dt>Period</dt>
                <dd class="fromdate">October 2007</dd>
                <dd class="todate">May 2008</dd>
                <dt>Name</dt>
                <dd class="title">some name</dd>
                <dt>Description</dt>
                <dd>blah blah</dd>
                <dt>Used skills</dt>
                <dd>
                    <ul class="skills">
                        <li>Pacal/Delphi</li>
                        <li>C++</li>
                        <li data-fromdate="Jan 2008">PHP</li>
                    </ul>
                </dd>
            </li>
        </ul>
    </div>

    <script>
        "use strict";

        var parseDate = d3.utcParse("%B %Y");
        var places = [];
        var projects = [];

        function getItemData(el) {
            return {
                id: el.attr("id"),
                title: el.select(".title").text(),
                from: parseDate(el.select(".fromdate").text()),
                to: d3.utcMonth.offset(parseDate(el.select(".todate").text()), 1),
                el: el,
            }
        }

        d3.selectAll("#work>li, #education>li").each(function () {
            places.push(getItemData(d3.select(this)));
        });

        d3.selectAll("#projects>li").each(function () {
            var el = d3.select(this);
            var item = getItemData(el)
            projects.push(item);
        });


        console.log(places);
        console.log(projects);


        function multiFormat(date) {
            return (d3.timeYear(date) < date ? d3.timeFormat("%b") : d3.timeFormat("%Y"))(date);
        }


        var margin = { top: 35, right: 20, bottom: 25, left: 20 };

        var holder = document.getElementById("svg-holder");
        var svg = d3.select(holder).append("svg");


        var xScale = d3
            .scaleTime()
            .domain([new Date(2005, 0, 1), new Date(2017, 12, 1)]);

        var xAxis = d3.axisTop(xScale).tickFormat(multiFormat);

        svg.append("g")
            .attr("id", "timeline")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        function redraw() {
            var width = svg.node().getBoundingClientRect().width - margin.left - margin.right,
                height = svg.node().getBoundingClientRect().height - margin.top - margin.bottom;

            xScale.range([0, width]);

            var widthPerTick = width / xScale.ticks().length;
            // Sigmoidal between 1 (no space) and 0 (a lot of space)
            var squashed = Math.pow(1 / (1 + Math.pow(Math.E, (widthPerTick - 30) / 5)), 3);

            svg.select("g#timeline")
                .transition()
                .call(xAxis)
                .selectAll("text")
                //.style("text-anchor", "start")
                .attr("font-size", (0.5 + 0.8 * Math.pow(1 - squashed, 0.3)) + "em")
                .attr("dx", Math.sin(squashed * Math.PI / 2) * 20 + "px")
                .attr("dy", Math.sin(squashed * Math.PI / 2) * 14 - 4 + "px")
                .attr("transform", "rotate(-" + 90 * squashed + ")");
        }

        redraw();
        //window.addEventListener("resize", redraw);

        var doit;
        window.addEventListener("resize", function () {
            clearTimeout(doit);
            doit = setTimeout(redraw, 150);
        });
    </script>
</body>

</html>