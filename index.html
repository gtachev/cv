<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <script src="./build/bundle.js"></script>

    <title></title>

    <style type="text/css">
        html,
        body {
            margin: 0;
            padding: 0;
        }

        #svg-holder {
            margin: 10px;
            /*width: 80%;
            max-width: 80%;
            */
            height: 600px;
            border: 1px solid blue;
            /*resize: horizontal;*/
            overflow: hidden;
            /*text-align: center;*/
            padding: 5px;
        }

        svg {
            border: 1px solid red;
            width: 100%;
            height: 100%;
        }

        .fromdate {
            float: left;
        }

        .todate::before {
            content: "\00A0-\00A0";
        }

        svg rect.education {
            fill: rgb(142, 185, 72);
            stroke: rgb(48, 83, 48);
            stroke-width: 1;
        }

        svg rect.work {
            fill: rgb(105, 170, 206);
            stroke: rgb(18, 40, 51);
            stroke-width: 1;
        }

        svg #skills rect {
            fill-opacity: 0.7;
            fill: rgb(223, 209, 88);
            stroke: rgb(92, 87, 47);
            stroke-width: 0.5;
            stroke-opacity: 0.5;
        }

        svg #skills rect:hover {
            stroke-width: 1;
            cursor: pointer;
        }

        svg text.place-label {
            font-family: sans-serif;
        }
    </style>
</head>

<body>
    <div id="svg-holder">
    </div>
    <div id="bio">
        <h1>Work experience</h1>
        <ul id="work">
            <li id="job1">
                <dt>Period</dt>
                <dd class="fromdate">June 2005</dd>
                <dd class="todate">February 2007</dd>
                <dt>Position</dt>
                <dd class="type">Web Developer</dd>
                <dt>Responsibilities</dt>
                <dd class="description">Maintenance and expansion of the existing company web sites</dd>
                <dt>Employer</dt>
                <dd class="title">Some company ltd.</dd>
            </li>
            <li id="job2" class="hidden">
                <dt>Period</dt>
                <dd class="fromdate">November 2007</dd>
                <dd class="todate">January 2008</dd>
                <dt>Position</dt>
                <dd class="type">Web Developer</dd>
                <dt>Responsibilities</dt>
                <dd class="description">Development of new projects, bugfixing and securing completed projects</dd>
                <dt>Employer</dt>
                <dd class="title">Some company 2 ltd.</dd>
                <dt>Used skills</dt>
                <dd>
                    <ul class="skills">
                        <li>PHP</li>
                        <li>HTML/CSS</li>
                        <li>SQL</li>
                        <li>JS</li>
                    </ul>
                </dd>
            </li>
            <li id="job3">
                <dt>Period</dt>
                <dd class="fromdate">February 2008</dd>
                <dd class="todate">January 2009</dd>
                <dt>Position</dt>
                <dd class="type">Backend Web Developer</dd>
                <dt>Responsibilities</dt>
                <dd class="description">blah blah</dd>
                <dt>Employer</dt>
                <dd class="title">Some company 3 ltd.</dd>
            </li>
            <li id="job4">
                <dt>Period</dt>
                <dd class="fromdate">February 2009</dd>
                <dd class="todate">November 2010</dd>
                <dt>Position</dt>
                <dd class="type">Freelance Web Developer</dd>
                <dt>Employer</dt>
                <dd class="title">Self-employed</dd>
            </li>
        </ul>
        <h1>Education</h1>
        <ul id="education">
            <li id="highschool">
                <dt>Period</dt>
                <dd class="fromdate">September 2002</dd>
                <dd class="todate">May 2007</dd>
                <dt>Type</dt>
                <dd class="type">High school</dd>
                <dt>Institution</dt>
                <dd class="title">Some high school</dd>
                <dt>Used skills</dt>
                <dd>
                    <ul class="skills">
                        <li>C++</li>
                    </ul>
                </dd>
            </li>
            <li id="highschool_extracurricular">
                <dt>Period</dt>
                <dd class="fromdate">October 2002</dd>
                <dd class="todate">September 2003</dd>
                <dt>Type</dt>
                <dd class="type">Extracurricular activities</dd>
                <dt>Institution</dt>
                <dd class="title">Student academy for computer informatics</dd>
                <dt>Used skills</dt>
                <dd>
                    <ul class="skills">
                        <li>C++</li>
                    </ul>
                </dd>
            </li>
            <li id="bachelors">
                <dt>Period</dt>
                <dd class="fromdate">October 2007</dd>
                <dd class="todate">May 2012</dd>
                <dt>Type</dt>
                <dd class="type">University bachelor's degree</dd>
                <dt>Institution</dt>
                <dd class="title">Some uni school</dd>
            </li>
        </ul>
        <h1>Projects and Skills</h1>
        <ul id="projects">
            <li id="some_project" data-where="highschool">
                <dt>Period</dt>
                <dd class="fromdate">October 2007</dd>
                <dd class="todate">May 2008</dd>
                <dt>Name</dt>
                <dd class="title">some name</dd>
                <dt>Description</dt>
                <dd class="description">blah blah</dd>
                <dt>Used skills</dt>
                <dd>
                    <ul class="skills">
                        <li>Pacal/Delphi</li>
                        <li>C++</li>
                        <li data-from="January 2008">PHP</li>
                    </ul>
                </dd>
            </li>
            <li id="some_project2" data-where="job1">
                <dt>Period</dt>
                <dd class="fromdate">February 2008</dd>
                <dd class="todate">December 2008</dd>
                <dt>Name</dt>
                <dd class="title">some name 2</dd>
                <dt>Description</dt>
                <dd class="description">blah blah 2</dd>
                <dt>Used skills</dt>
                <dd>
                    <ul class="skills">
                        <li>C++</li>
                        <li data-from="June 2008">PHP</li>
                    </ul>
                </dd>
            </li>
        </ul>
    </div>

    <script>
        "use strict";

        var directory = new Map();
        var skills = [];
        var skillNames = new Set();

        var itemCallback = function (item) {
            if (directory.has(item.id)) {
                console.error("Duplicate item id " + item.id);
            } else {
                directory[item.id] = item;
            }

            item.skills.forEach(skill => {
                skills.push(skill);
                skillNames.add(skill.name);
            });
        }

        console.log(cv);

        var places = cv.data.getItemsData(document, "#work>li, #education>li", itemCallback);
        var projects = cv.data.getItemsData(document, "#projects>li", itemCallback);
        skills.sort((a, b) => a.to - a.from < b.to - b.from);

        console.log(places);
        console.log(projects);
        console.log(skillNames);
        console.log(skills);


        var holder = document.getElementById("svg-holder");
        var chart = new cv.MutiTimeline(holder, places, skills, skillNames);
        console.log(chart);

        chart.draw();
        var doit;
        window.addEventListener("resize", function () {
            clearTimeout(doit);
            doit = setTimeout(() => chart.redraw(), 150);
        });
    </script>
</body>

</html>